# 限流



#### 概念

访问频率较高的接口，可能会造成部分用户无法访问



#### 限流算法

1. 令牌桶：用户的请求速率是不固定的，这里我们假定为10r/s，令牌按照5个每秒的速率放入令牌桶，桶中最多存放20个令牌。仔细想想，是不是总有那么一部分请求被丢弃。
2. 漏桶：控制数据注入到网络的速率，平滑网络上的突发流量。漏桶算法提供了一种机制，通过它，突发流量可以被整形以便为网络提供一个稳定的流量



#### Tomcat 限流

自定义线程池，配置最大连接数，请求处理队列等参数来达到限流的目的。



#### API 限流

采用开源工具包guava提供的限流工具类RateLimiter进行API限流，该类基于"令牌桶算法"，开箱即用。



#### NGINX 分布式限流

比如单个IP限制每秒访问50次。通过Nginx限流模块，我们可以设置一旦并发连接数超过我们的设置，将返回503错误给客户端。

limit_req_zone