# CAP

#### 概述

一个分布式系统不可能在满足**分区容错性（P）**的情况下同时满足**一致性（C）**和**可用性（A**）。在此**ZooKeeper保证的是CP**，ZooKeeper**不能保证每次服务请求的可用性**，在极端环境下，ZooKeeper可能**会丢弃一些请求**，消费者程序需要**重新请求**才能获得结果。另外在进行**leader选举时集群都是不可用**，所以说，ZooKeeper不能保证服务可用性。



#### C

1. Consistency，一致性
2. 比如一条数据，分别存在两个服务器中，server1和server2。我们此时将数据a通过server1修改为数据b。此时如果我们访问server1访问的应该是b。当我们访问server2的时候，如果返回的还是未修改的a，那么则不符合一致性，**修改集群数据，数据同步**修改才有一致性。



#### A

1. Availability，可用性
2. 对服务器发送请求，服务器必须对我进行相应，保证**服务器一直是可用**的。就是**集群节点不能全部不可用**



#### P

1. Partition tolerance，分区容错
2. 比如我们的一台服务器在北京，一台在上海。可能由于天气等原因的影响。造成了两条服务器直接不能互相通信，数据不能进行同步。
3. **分区容错是不可避免的。也就是说 P 是必然存在**的。



#### 为什么CAP只能达到 CP 或者 AP？

如果我们保证了CP，即一致性与分布容错。当我们通过一个服务器A修改数据后，该服务器A会**向另一个服务器B发送请求，将数据进行同步**，但此时，该**数据应处于锁定状态**不能接受请求，服务器 B 进行锁定，不可再次修改，这样，如果此时我们想服务器发送请求，则得不到相应，这样就不能A，高可用。
如果我们保证了**AP**，那么我们**不能对服务器进行锁定**，任何时候都要得到相应，那么数据的一致性C就不能保全。

ZK 保障CP：会出现不可用

Eruka 保障 AP：会出现数据不一致