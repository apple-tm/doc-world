# 架构



#### 概述

1. **分布式文件系统**
2. 高度**容错**
3. 适合**廉价机器**
4. **高吞吐**数据访问
5. 可由**上万服务器**构成
6. HDFS采用**master/slave架构**



#### 优点

1. 高可靠性：多个数据副本节点，单节点故障不会导致数据丢失
2. 高扩展性：集群执行任务，可以动态伸缩增加减少任务资源
3. 高效性：分布式集群并行处理任务
4. 高容错：具有失败任务重试机制



#### 设计目标

1. 部分**服务器故障是常态**（服务器数量巨大，一部分失效概率极大）
2. **错误检测**、**自动恢复**是最核心的架构目标
3. 需要**流式**访问
4. **流式数据访问**，就相当下载10G的电影，用迅雷边下边播的模式。
5. 非**流式数据访问**，就相当于，10G的电影，完全下好了，再播放。
6. 管理的文件大小：一般都在 G 字节到 T 字节，**数据带宽高**
7. 一次写入、多次访问，文件创建后不需要改变
8. **移动计算比比移动复制更划算**，将计算移动到数据附近



#### 架构图

![HDFS 架构](http://hadoop.apache.org/docs/r1.0.4/cn/images/hdfsarchitecture.gif)

replication：拷贝

Rock: 块

NameNode: 存储文件元数据

DataNode: 存储文件数据

SecondaryNameNode: NameNode 备份节点



#### yarn

1. Hadoop 资源调度者
2. ResourceManager: 集群老大
3. NodeManager：单节点服务器老大
4. ApplicationMaster：单任务的老大
5. Container：独立的虚拟服务器



#### Namenode

1. 作用：中心服务器
2. 管理文件系统的**名字空间**和**客户端对文件的访问**
3. 一个HDFS集群是由一**个Namenode**和**一定数目的Datanodes**组成

3. Namenode执行文件系统的名字空间操作，比如**打开、关闭、重命名文件或目录**。

4. 负责确定**数据块到具体Datanode节点的映射**

5. Namenode的统一调度下进行**数据块的创建、删除和复制**。

6. 用户数据永远不会流过Namenode。

7. 任何对文件系统**名字空间或属性的修改都将被Namenode记录**下来

8. 可以**设置HDFS保存的文件的副本数目**。文件副本的数目称为文件的副本系数，这个信息也是由Namenode保存的。

9. Namenode全权管理数据块的复制，周期性地从集群中的每个Datanode接收**心跳信号**和**块状态报告**

10. 接收到心跳信号意味着该Datanode**节点工作正常**。

11. 块状态报告包含了一个该Datanode上所有**数据块的列表**。

12. Namenode**不会主动发起RPC**，而是响应来自客户端或 Datanode 的RPC请求。

    

#### DataNode

1. Datanode一般是**一个节点一个**
2. HDFS暴露了文件系统的名字空间，用户能够以文件的形式在上面存储数据。
3. **一个文件其实被分成一个或多个数据块**，这些**块存储在一组Datanode**上
4. Datanode负责处理**文件系统客户端的读写请求**
5. 将每个文件**存储成一系列的数据块**，除了最后一个，所有的数据块都是同样大小的
6. 为了容错，**文件**的所有数据块**都会有副本**
7. **数据块大小和副本系数都是可配置**的
8. HDFS中的文件都是**一次性写入的**，并且严格要求在任何时候**只能有一个写入者**。
9. HDFS中的文件**总是按照64M被切分成不同的块**，每个块尽可能地存储于不同的Datanode中。



#### 副本机制

1. 在大多数情况下，副本**系数是3**，HDFS的存放策略是将**一个副本存放在本地机架的节点**上，**一个副本放在同一机架的另一个节点**上，最后**一个副本放在不同机架的节点上**。这种策略**减少了机架间的数据传输**，这就**提高了写操作**的效率。

2. HDFS会**尽量让读取程序读取离它最近的副本**,降低整体的带宽消耗和读取延时

   

![截屏2021-04-14 下午3.59.27](/Users/apple/Documents/tool/hadoop3/截屏2021-04-14 下午3.59.27.png)

![截屏2021-04-14 下午2.56.14](/Users/apple/Documents/tool/hadoop3/截屏2021-04-14 下午2.56.14.png)

