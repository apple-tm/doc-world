# 规则



#### 列族

1. **官方推荐的是列族最好小于或者等于3。我们使用的场景一般是1个列族。**
2. **列族是由一个一个的列组成（任意多）**
3. Region的概念和关系型数据库的分区或者分片差不多
4. Hbase会将一个大表的数据基于Rowkey的不同范围分配到不通的Region中，注意热点数据汇聚，各 Region 负载不均衡，HASH 处理



#### 查询

1. 基于 rowkey的单行查询
2. 基于 rowkey 的范围查询
3. 全表扫描
4. Rowkey对Hbase的性能影响非常大
5. 兼顾基于Rowkey的单行查询也要键入Rowkey的范围扫描



#### 快照数据

1. TimeStamp对Hbase来说至关重要，因为它是实现Hbase多版本的关键
2. 在Hbase中使用不同的timestame来标识**相同rowkey行对应的不通版本的数据**
3. 写入数据的时候，如果用户没有指定对应的timestamp，Hbase会自动添加一个timestamp，timestamp和服务器时间保持一致。
4. 在Hbase中，**相同rowkey的数据按照timestamp倒序排列**。**默认查询的是最新的版本**，用户可同指定timestamp的值来读取旧版本的数据。



#### 特色

1. 读慢写快
2. 基于LSM树实现的HBase的写性能比MySQL高了一个数量级，读性能低了一个数量级
3. LSM树原理
   1. 把一棵大树拆分成N棵小树
   2. 写入内存中，随着小树越来越大，内存中的小树会flush到磁盘
   3. 磁盘中的树定期可以做merge操作，合并成一棵大树
   4. 将对数据的修改增量保持在内存中，达到指定的大小限制后将这些修改操作批量写入磁盘
   5. 缺点：
      1. 读取的时候稍微麻烦，需要合并磁盘中历史数据和内存中最近修改操作
      2. 取时可能需要先看是否命中内存，否则需要访问较多的磁盘文件

