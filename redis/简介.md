# 简介



#### 概述

数据结构服务器



#### 应用场景

1. 缓存
2. 共享 session，分布式项目中会话跟踪
3. 消息队列
4. 分布式锁



#### 单线程的Redis 为什么快

1. 纯内存操作
2. 单线程避免频繁上下文切换
3. 合理高效的数据结构
4. 采用**非阻塞IO多路复用机制**



#### 数据过期策略

1. 定期删除
   1. 启用一个定时器**定时监视所有的 key**，判断key是否过期，过期的话就删除
   2. 保证过期的 key 最终都会被删除
   3. 缺点：每次都遍历内存中所有的数据，非常消耗 CPU 资源，并且当 key 已过期，但是定时器还处于未唤起状态，这段时间内 key 仍然可以用。
2. 惰性删除
   1. **获取 key 时，先判断 key 是否过期，如果过期则**删除
   2. 缺点：如果这个 key 一直未被使用，那么它一直在内存中，其实它已经过期了，会浪费大量的空间。
3. 种策略天然的互补
   1. 定时删除策略不在是每次扫描全部的 key 了，而是随机抽取一部分 key 进行检查，降低了对 CPU 资源的损耗
   2. 惰性删除
4. 没有被定时器抽取到，又没有被使用，内存淘汰
   1. 内存不足以容纳新写入数据时，新写入操作会报错。（Redis **默认**策略）
   2. 内存不足以容纳新写入数据时，在键空间中，**移除最近最少使用的 Key**。（**LRU推荐**使用）
   3. 内存不足以容纳新写入数据时，在键空间中，**随机移除**某个 Key。
   4. 内存不足以容纳新写入数据时，在**设置了过期时间的键空间中，移除最近最少使用的 Key**。这种情况一般是把 Redis 既当缓存，又做持久化存储的时候才用。
   5. 内存不足以容纳新写入数据时，在设置了**过期时间的键空间中，随机移除**某个 Key。
   6. 内存不足以容纳新写入数据时，在设置了**过期时间的键空间中，有更早过期时间的 Key** 优先移除

#### 基本数据结构

KV 型

**键K都是字符串类型**



#### V 的数据类型

1. String 
2. List
3. Hash
4. Set
5. SortedSet
6. HyperLogLog（基数计算）
7. geo(地理)
8. Stream(消息队列，提供了消息的持久化和主备复制功能，弥补发布订阅的消息无法持久化的缺点，出现网络断开、Redis 宕机等，消息就会被丢弃)



#### 特点

1. 支持**持久化**，数据可保存在磁盘上，重启可加载使用
2. 支持数据**备份**，MS 模式
3. **性能极高**：读-110000t/s,写-81000t/s
4. **原子**性：所有操作都是原子性的，意思就是要么成功执行要么失败完全不执行。单个操作是原子性的。多个操作也**支持事务**，即原子性，通过MULTI和EXEC指令包起来。
5. 支持publish\subscribe **发布订阅**模式
6. 支持**通知**
7. 支持**超时过期**机制
8. 相对于关系型数据库的**假事务**，就是一个批量执行 order 的容器



#### 对比其他 KV 数据库

1. 多种数据结构

2. 持久化

   