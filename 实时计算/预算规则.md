# 接入方案



#### 确定服务

1. 需求
2. 实时任务
3. 离线任务



实时计算案例：vcore = 每秒数据条数/5000 * 计算复杂度 * 数据膨胀率

1. 默认每秒处理 5000 条普通 SQL

2. 计算复杂度：SQL 中聚合函数使用数量评估，1 个聚合函数计算复杂度为 1
3. 数据膨胀率：SQL 中存在视图、一行转多行，一个 1 行转 2 行，数据膨胀率为 2

| 任务      | 每秒数据量 | 计算复杂度 | 数据膨胀率 | vcore | 物理机 | 云主机 |
| --------- | ---------- | ---------- | ---------- | ----- | ------ | ------ |
| 日志 信息 | 30000      | 3          | 3          | 54    | 1.13   | 27     |
| 监控信息  | 6000       | 3          | 2          | 7.2   | 0.15   | 3.6    |
| QPS 信息  | 8000       | 8          | 2          | 25.6  | 0.53   | 12.8   |
| 告警信息  | 500        | 1          | 1          | 0.1   | 0      | 0.05   |
| 汇总      |            |            |            | 86.9  | 1.81   | 43.45  |



离线计算案例： vcore = 数据量/4GB

1. 默认一个 vcore 处理 4GB 数据
2. 1 个 CPU 虚化 2 个 vcore
3. 1台高 IO 物理机 24 核（48vcore）
4. 低于 48vcore 协调共用一台物理机

| 任务 | 数据量（GB） | vcore | 物理机数量 | 云主机（CPU） |
| ---- | ------------ | ----- | ---------- | ------------- |
| 日志 | 200          | 50    | 1.04       | 25            |
| 监控 | 100          | 25    | 0.52       | 12.5          |
| qps  | 100          | 25    | 0.52       | 12.5          |
| 汇总 |              | 100   | 2.08       | 50            |



附：

平安云高 IO 24C384GB 物理机报价

| 产品类型   | CPU  | 内存 | 磁盘                        | 元/天  | 元/年 |
| ---------- | ---- | ---- | --------------------------- | ------ | ----- |
| 存储型 S19 | 24   | 384  | 12 * 4TB SATA, 2 * 600GBSAS | 254.63 | 92929 |

kafka 最低预算 3 台 2C8G 云主机

357.19 * 3 * 12 = 12858.84/年